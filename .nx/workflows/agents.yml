launch-templates:
  wolsokmono-linux-extra-large:
    resourceClass: 'docker_linux_amd64/extra_large'
    image: 'ubuntu22.04-node20.11-v9'
    env:
      HUSKY: 0
      NODE_OPTIONS: '--max_old_space_size=4096'

    init-steps:
      - name: Checkout # using a reusable step
        uses: 'nrwl/nx-cloud-workflows/v5/workflow-steps/checkout/main.yaml'
        env:
          GIT_CHECKOUT_DEPTH: '50'
          GIT_FETCH_TAGS: 'true'

      - name: Install Node
        uses: 'nrwl/nx-cloud-workflows/v5/workflow-steps/install-node/main.yaml'

      - name: Install necessary binaries
        script: |

          echo "node version used: $(node -v)"

          echo "Install packages to compile node_modules gl with node-gyp"
          sudo apt-get update -y
          sudo apt-get install -y build-essential pkg-config python3 python-is-python3 libx11-dev libxext-dev libxi-dev libxrandr-dev libxfixes-dev libxcursor-dev libxinerama-dev libgl1-mesa-dev libglu1-mesa-dev mesa-common-dev xserver-xorg-dev libavif13 libgtk-4-1 libgraphene-1.0-dev

      - name: Restore Node Modules Cache
        uses: 'nrwl/nx-cloud-workflows/v5/workflow-steps/cache/main.yaml'
        inputs:
          key: 'package-lock.json'
          paths: |
            ~/workflows/workspace/node_modules/
            ~/.npm
          base-branch: 'main'

      - name: Install Node Modules
        script: |
          npm install

      - name: Install Browsers (if needed)
        uses: 'nrwl/nx-cloud-workflows/v5/workflow-steps/install-browsers/main.yaml'
